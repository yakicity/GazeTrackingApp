
-----

# Streamlit版 簡易アイトラッキングUI

Webカメラを使用してリアルタイムでユーザーの視線を推定し、画面のどの領域をどれくらいの時間見ていたかを分析するアプリケーションです。

-----

## 技術仕様

### AIモデル

  * **モデル**: Googleの **MediaPipe Face Mesh** を利用しています。
  * **仕組み**:
    1.  このモデルは、カメラ映像からリアルタイムで最大478個の顔のランドマーク（特徴点）を検出します。
    2.  本アプリケーションでは、特に**両目の瞳と虹彩に対応するランドマーク**の位置情報を取得します。
    3.  「目の中心」と「虹彩の中心」の相対的な位置関係から、視線のおおよその方向ベクトルを幾何学的に計算しています。

### フロントエンド

  * **フレームワーク**: **Streamlit**
  * **概要**: Streamlitを使用し、インタラクティブなWeb UIをPythonのみで構築しています。
  * **機能**:
    * **視聴領域分析**: 画面を4つの領域に分割し、各領域の合計視聴時間を計測します。
    * **セッション管理**: 「分析開始」「分析終了」ボタンで、任意の期間のデータを計測できます。
    * **結果の可視化**: 現在の分析セッションの結果をテーブル形式でリアルタイムに表示します。
    * **履歴管理**: 過去の分析結果をタイムスタンプと共にリスト形式で保存し、いつでも確認できます。
    * **データエクスポート**:
        * 現在の分析結果を**JSON形式**でダウンロードできます。
        * 全ての履歴をまとめて**PDF形式**でダウンロードできます。

### バックエンド

  * **言語**: **Python**
  * **概要**: Streamlitのサーバープロセス内で、映像処理、視線推定、データ集計などのすべてのロジックを実行します。特別なWebサーバーやAPIは必要ありません。
  * **機能**:
      * 現在は、streamlitを終了させてしまうと、過去の視線分析結果は消えてしまいます。

-----

## ビジネス要件・分析仕様

  * **画面分割**:
      * カメラが捉える映像（ユーザーが見ている画面と仮定）を、\*\*縦横2分割の合計4領域（左上、右上、左下、右下）\*\*に分割して分析します。
  * **データ集計方法**:
      * 視線推定のサンプリングは、**Webカメラからフレームが送られてくるたび**に行われます（フレームレートはPCの性能やカメラに依存します）。
      * 前のフレームから現在のフレームまでの経過時間を算出し、その時間に視線があった領域の合計視聴時間に加算していきます。
      * これにより、「どの領域を合計で何秒間見ていたか」という**累積視聴時間**を計測します。

-----

## セットアップと実行方法

#### 1\. 前提条件

  * Python 3.12〜
  * Webカメラ

#### 2\. ライブラリのインストール

以下のコマンドを実行して、必要なライブラリをインストールします。

```shell
pip install -r requirements.txt
```

#### 3\. アプリケーションの実行

ターミナルで以下のコマンドを実行します。

```shell
streamlit run app.py
```